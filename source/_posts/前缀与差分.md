---
title: 前缀与差分
categories:
  - 基础算法
  - 竞赛
  - 竞赛模板
tags:
  - 前缀
  - 差分
  - c++
abbrlink: 36339
date: 2021-10-21 10:13:53
---

## 前缀与差分

### 前缀

其实质是数组的前i项和。<!-- more -->

### 一维前缀

原数组 ： a1 a2 a3 a4 ... an

前缀和 :    Si = a1 + a2 + ...+ ai

#### 计算与应用

计算：   令 `s0 =  0 `;     `s[i] =  s[i-1] + a[i]`

应用(也是唯一应用)：  可以直接求出[l , r]下标区间内元素和 `value = s[r] - s[l-1]`

#### 代码模板

```java
const int N = 1e5 + 10 ;
int a[N],s[N];

int main(){
    ios::sync_with_stdio(false);    // 使得cin 与 scanf 速度相同 ，但是以后不得再使用scanf，只能用cin
    int n ;
    cin >> n ;
    for(int i = 1  ; i <= n ; ++i)  cin >> a[i];
    
    s[0] = 0 ;
    for(int s = 1  ; s <= n ; ++i)  s[i] = s[i-1] + a[i];

    int l , r ;
    cin >> l >> r ;
    int ans = s[r] - s[l-1];

     return 0 ;
}
```

### 二维前缀

Si,j 表示左上角所有元素之和

#### 计算

前缀和 => ` s[i][j] = s[i-1][j] + s[i][j-1] - s[i-1][j-1] + a[i][j];`

子矩阵面积 => ` Sx2,y2 =  Sx2,y1  +   Sx1-1,y2    -   Sx1 -1,y1 - 1  + ax2,y2 `

![picture](/img/jcsf4.jpg)

#### 代码模板

```java
void work(){
    // 构造二维前缀和(黄色部分)
    for(int i = 1 ; i <= n ; ++i)
        for(int j = 1 ; j <= n ; ++j)
            s[i][j] = s[i-1][j] + s[i][j-1] - s[i-1][j-1] + a[i][j];
    
    // 询问子矩阵(蓝色部分)
    while(cnt--){
        int x1 ,y1 ,x2 ,y2;
        cin >> x1 ,y1 ,x2 ,y2;
        int ans = s[i][j] - s[i][j-1] - s[i-1][j] + s[i-1][j-1];   
        cout<<ans<<endl;
    }
    
}
```

### 差分

前缀和逆运算

对于数列  a1 a2 a3 ...  an

构造  b1 b2  b3  ... bn

使得  ai =  b1 + b2 + .... + bi

#### 一维差分构造方法

b1 = a1 

b2 = a2 - a1

bn = an - a(n-1)

#### 一维差分应用

使序列a的[l,r]`区间内数字都加一个值c,`如果遍历相加，则需要O(n)

若使`b[l] += c  b[r+1] -= c` 来实现，则需要O(1)的时间

#### 一维差分代码模板

```java
// 使得区间[l,r]内元素全部加一
void insert(int l ,int r ,int c){
     b[l]   += c;
     b[r+1] -= c;
}

//构造
b[1] = a[1] ;
for(int i = 2 ; i <= n ; ++1) b[i] = a[i] - a[i-1];
cin >> l >> r >> c;
insert(l,r,c);
```

#### 二维差分数组

只要满足原矩阵是差分数组之和即可

#### 二维差分数组计算方法

对于二维差分，即对一个子矩阵加一个c值即可

若想给(x1,y1) 到 (x2,y2)内的子矩阵加c，使用b[x1,y1] + c ，相当于右下角全部加c,  因此需要进行如下处理

`b[x1,y1] += c`     ` b[x1][y1 + 1]-= c `   `b[x1 + 1][y1] -= c`  `b[x1 + 1][y1 + 1] += c`     

![picture](/img/jcsf5.jpg)

#### 代码模板

#### 二维差分代码模板

```java
void  insert(int x1 , int y1 , int x2 ,int y2 , int c){
       b[x1][y1] += c ;
       b[x1 + 1][y1] -= c ;
       b[x1][y1 + 1] -= c;
       b[x1+1][y1+1] += c;
}

int main(){
    
    for(int i =1 ; i <= n ; ++i)
        for(int j = =1; j <= n ; ++j)
            cin >> a[i][j];
    
    //构造差分矩阵
    for(int i =1 ; i <= n ; ++i)
        for(int j = =1; j <= n ; ++j)
            insert(i,j,i,j,a[i][j]);
    
    // 对部分子矩阵值进行加减
    while(q--){
        int x1 , y1 , x2 ,y2 , c;
        cin >> x1 >> y1 >> x2 >> y2 >> c;
        insert(x1,y1,x2,y2,c);
    }
    
    // 计算b的前缀和，即对部分子矩阵值进行加减 a数组的值，并保存在b矩阵中
    for(int i = 1 ; i <= n; i++)
        for(int j = 1; j <= n ; ++j)
            b[i][j] += b[i-1][j] + b[i][j-1] - b[i-1][j-1];
    
    // 打印a数组的值
    for(int i = 1 ; i <= n; i++)
        for(int j = 1; j <= n ; ++j)
             cout<<b[i][j]<<" ";
    	cout<<endl;
    return 0 ;
}
```



